(this["webpackJsonpbasic-virtual-tryon-glasses"]=this["webpackJsonpbasic-virtual-tryon-glasses"]||[]).push([[0],[,,,,function(e,t,n){e.exports=n(11)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(3),i=n.n(o),s=(n(9),n(10),n(0));const c=33,d=263,l=133,u=362,m=127,p=356,v=234,w=454,h=10,g=175,f=168,y=1,b=[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],E=140,k=210,B=10,x=2,M=0,S=1.22;function j(e,t,n){return Math.max(t,Math.min(n,e))}function C(e,t){return new s.B(-e[t][0],-e[t][1],-e[t][2])}function R(e,t){return e.clone().add(t).multiplyScalar(.5)}function z(e,t,n){return R(C(e,t),C(e,n))}function F(){var e=new s.j,t=new s.p({color:4005645,metalness:0,roughness:.16,clearcoat:.95,clearcoatRoughness:.06,reflectivity:.5,side:s.h}),n=new s.q({color:13215054,metalness:.92,roughness:.12,side:s.h}),a=new s.q({color:10518576,metalness:.88,roughness:.18,side:s.i}),r=new s.p({color:1846812,metalness:.05,roughness:.02,transparent:!0,opacity:.68,side:s.h,depthWrite:!1,clearcoat:1,clearcoatRoughness:.03,envMapIntensity:.3});function o(e){var t=function(e,t,n){n=n||72;for(var a=[],r=0;r<=n;r++){var o=r/n*Math.PI*2;a.push(new s.B(Math.cos(o)*e*.5,Math.sin(o)*t*.5,0))}return new s.e(a,!0)}(52,43),a=new s.A(t,72,.7,8,!0),r=new s.n(a,n);return r.position.x=e,r}function i(e){var t=new s.w;t.absellipse(0,0,25.22,20.855,0,2*Math.PI,!1,0);var n=new s.x(t,48),a=new s.n(n,r);return a.position.set(e,0,.2),a}e.add(o(-36)),e.add(o(36)),e.add(i(-36)),e.add(i(36));var c=[new s.B(-17.8,3.44,.7),new s.B(-4.25,43*.18,1.4),new s.B(0,9.46,1.75),new s.B(4.25,43*.18,1.4),new s.B(17.8,3.44,.7)],d=new s.e(c),l=new s.A(d,24,.84,8,!1);function u(e){var a=new s.j,r=64.5*e;a.position.set(r,8.6,0);var o=new s.e([new s.B(0,0,0),new s.B(0,0,-28),new s.B(0,0,-56)]),i=new s.A(o,32,1,8,!1);a.add(new s.n(i,n));var c=new s.e([new s.B(0,0,-36.4),new s.B(0,0,.82*-56),new s.B(0,0,-56)]),d=new s.A(c,16,1.6,8,!1);return a.add(new s.n(d,t)),a.rotation.y=.06*e,a}function m(e){var t=new s.j,r=new s.f(1.4,1.4,4,12),o=new s.n(r,n);t.add(o);var i=new s.b(3.5,5,1.3),c=new s.n(i,n);c.position.set(1.5*-e,0,0),t.add(c);var d=new s.f(.5,.5,.4,8),l=new s.n(d,a);return l.rotation.x=Math.PI/2,l.position.set(2.2*-e,0,.8),t.add(l),t.position.set(63*e,8.6,-.5),t}return e.add(new s.n(l,n)),e.add(u(-1)),e.add(u(1)),e.add(m(-1)),e.add(m(1)),e.traverse((function(e){e.isMesh&&(e.renderOrder=3)})),e}var O,P,A,I,L,W,N,T;let V=!1;const q={ready:!1,gPos:new s.B,gQuat:new s.u,gScale:new s.B(1,1,1),prev:new s.B};function U(){I.needsUpdate=!0,requestAnimationFrame(U),W.render(T,N)}function D(e){L=document.getElementById("tryon-video");var t=document.getElementById("threejsContainer");N=function(e){var t=e.videoWidth,n=e.videoHeight,a=new s.r(-t/2,t/2,n/2,-n/2,.1,5e3);return a.position.set(-t/2,-n/2,500),a}(L);var n=function(e,t){var n=e.videoWidth,a=e.videoHeight,r=new s.z(e);r.minFilter=s.l;var o=new s.y(new s.o({map:r,depthWrite:!1,side:s.h}));return o.center.set(.5,.5),o.scale.set(-n,a,1),o.position.copy(t.position),o.position.z=0,{bg:r,sprite:o}}(L,N);I=n.bg,W=function(e){var t=new s.C({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});return t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.setSize(640,640*e.videoHeight/e.videoWidth),t.physicallyCorrectLights=!0,t.toneMapping=s.a,t.toneMappingExposure=1.1,t.outputEncoding=s.D,t}(L),t.appendChild(W.domElement),(T=new s.v).add(n.sprite);var a=new s.s(W);a.compileCubemapShader();var r=a.fromScene(new s.v).texture;T.environment=r,a.dispose(),function(){var e=new s.g(16777215,1.2);e.position.set(0,120,250);var t=new s.g(15659263,.5);t.position.set(-100,40,120);var n=new s.g(16777215,.4);n.position.set(60,80,-100);var a=new s.g(16777215,.25);return a.position.set(0,200,50),[e,t,n,a,new s.k(16777215,4473958,.5)]}().forEach((function(e){T.add(e)})),(A=function(){for(var e=b.length,t=new Float32Array(3*(e+1)),n=[],a=0;a<e;a++)n.push(0,a+1,(a+1)%e+1);var r=new s.d;r.setAttribute("position",new s.c(t,3)),r.setIndex(n);var o=new s.o({colorWrite:!1,side:s.h}),i=new s.n(r,o);return i.renderOrder=1,i.frustumCulled=!1,i}()).visible=!1,T.add(A),(P=F()).visible=!1,T.add(P),window.addEventListener("resize",(function(){!function(e,t,n){var a=n.videoWidth,r=n.videoHeight;e.left=-a/2,e.right=a/2,e.top=r/2,e.bottom=-r/2,e.updateProjectionMatrix(),t.setSize(640,640*r/a)}(N,W,L)}),!1),U()}function H(){L?"function"===typeof L.requestVideoFrameCallback?L.requestVideoFrameCallback((function(){Q()})):requestAnimationFrame(Q):requestAnimationFrame(H)}function Q(){if(V)H();else{if(V=!0,!O)return V=!1,void H();var e,t,n=O.detectForVideo(L,performance.now());if(n.faceLandmarks&&n.faceLandmarks.length>0&&P){P.visible=!0,A&&(A.visible=!0);var a=function(e,t){var n=t.videoWidth,a=t.videoHeight;return e.map((function(e){return[e.x*n,e.y*a,e.z*n]}))}(n.faceLandmarks[0],L),r=z(a,l,c),o=z(a,u,d),i=C(a,f),F=C(a,y),I=C(a,h),W=C(a,g),N=C(a,m),T=C(a,p),U=C(a,v),D=C(a,w),Q=R(r,o),G=r.distanceTo(o),J=N.distanceTo(T),X=U.distanceTo(D),Y=Math.max(G,J,X),Z=I.distanceTo(W),_=o.clone().sub(r).normalize(),$=I.clone().sub(W).normalize(),K=_.clone().cross($).normalize();K.z<0&&K.negate();var ee=K.clone().cross(_).normalize(),te=(new s.m).makeBasis(_,ee,K),ne=(new s.u).setFromRotationMatrix(te),ae=(new s.u).setFromAxisAngle(new s.B(0,0,1),Math.PI);ne.multiply(ae);var re=j(.1*F.clone().sub(i).length(),0,6),oe=Q.clone().addScaledVector(_,M).addScaledVector(ee,x).addScaledVector(K,B+re),ie=(.7*(Y/E)+.3*(Z/k))*S,se=new s.B(ie,ie,ie),ce=oe.distanceTo(q.prev),de=(e=q.gQuat,t=ne,2*Math.acos(j(Math.abs(e.dot(t)),0,1))),le=j(.15+.015*ce,.15,.55),ue=j(.2+.6*de,.2,.75),me=j(.16+.01*ce,.16,.45);if(q.ready?(q.gPos.lerp(oe,le),q.gQuat.slerp(ne,ue),q.gScale.lerp(se,me)):(q.gPos.copy(oe),q.gQuat.copy(ne),q.gScale.copy(se),q.ready=!0),q.prev.copy(oe),P.position.copy(q.gPos),P.quaternion.copy(q.gQuat),P.scale.copy(q.gScale),P.updateWorldMatrix(!0,!0),A){for(var pe=A.geometry.getAttribute("position"),ve=0,we=0,he=0,ge=0;ge<b.length;ge++){var fe=C(a,b[ge]);fe.addScaledVector(K,8),pe.setXYZ(ge+1,fe.x,fe.y,fe.z),ve+=fe.x,we+=fe.y,he+=fe.z}ve/=b.length,we/=b.length,he/=b.length;var ye=.5*Y;pe.setXYZ(0,ve-K.x*ye,we-K.y*ye,he-K.z*ye),pe.needsUpdate=!0}}else P&&(P.visible=!1),A&&(A.visible=!1),q.ready=!1;V=!1,H()}}const G=()=>{const[e,t]=Object(a.useState)(!0),[n,o]=Object(a.useState)(!1),i=Object(a.useRef)(null),s=Object(a.useRef)([]);Object(a.useEffect)(()=>(async function(){var e=document.getElementById("tryon-video");await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}).then(t=>{e.srcObject=t}),e.oncanplay=()=>{e.play(),D(),async function(){var e=await import("https://unpkg.com/@mediapipe/tasks-vision@0.10.7/vision_bundle.mjs"),t=await e.FilesetResolver.forVisionTasks("https://unpkg.com/@mediapipe/tasks-vision@0.10.7/wasm");O=await e.FaceLandmarker.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-assets/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",numFaces:1,outputFaceBlendshapes:!1,outputFacialTransformationMatrixes:!1}),H()}(),t(!1)}}(),()=>{}),[]);const c=Object(a.useCallback)(()=>{var e=document.querySelector("#threejsContainer canvas");if(e){var t=document.createElement("a");t.download="virtual-tryon-"+Date.now()+".png",t.href=e.toDataURL("image/png"),t.click()}},[]),d=Object(a.useCallback)(()=>{if(n)return i.current&&"inactive"!==i.current.state&&i.current.stop(),void o(!1);var e=document.querySelector("#threejsContainer canvas");if(e){s.current=[];var t=e.captureStream(30),a=MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?"video/webm;codecs=vp9":"video/webm",r=new MediaRecorder(t,{mimeType:a});r.ondataavailable=function(e){e.data.size>0&&s.current.push(e.data)},r.onstop=function(){var e=new Blob(s.current,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");n.download="virtual-tryon-"+Date.now()+".webm",n.href=t,n.click(),URL.revokeObjectURL(t)},r.start(),i.current=r,o(!0)}},[n]);return r.a.createElement("div",{className:"tryon-page"},r.a.createElement("div",{className:"tryon-header"},r.a.createElement("h1",{className:"tryon-title"},"Virtual Try-On"),r.a.createElement("p",{className:"tryon-subtitle"},"AI-Powered Glasses Experience")),r.a.createElement("div",{className:"tryon-viewport"},e&&r.a.createElement("div",{className:"tryon-loading"},r.a.createElement("div",{className:"tryon-spinner"}),r.a.createElement("p",null,"Initializing camera...")),r.a.createElement("div",{id:"threejsContainer"},r.a.createElement("video",{id:"tryon-video"}))),r.a.createElement("div",{className:"tryon-controls"},r.a.createElement("button",{className:"tryon-btn",onClick:c,title:"Take Screenshot"},r.a.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},r.a.createElement("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),r.a.createElement("circle",{cx:"12",cy:"13",r:"4"})),"Screenshot"),r.a.createElement("button",{className:"tryon-btn tryon-btn-record"+(n?" recording":""),onClick:d,title:n?"Stop Recording":"Start Recording"},r.a.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},n?r.a.createElement("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2",fill:"currentColor"}):r.a.createElement("circle",{cx:"12",cy:"12",r:"7",fill:"currentColor"})),n?"Stop":"Record")),r.a.createElement("p",{className:"tryon-footer"},"Powered by MediaPipe + Three.js"))};function J(){return r.a.createElement("div",{className:"App"},r.a.createElement(G,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}],[[4,1,2]]]);
//# sourceMappingURL=main.ea2fe755.chunk.js.map