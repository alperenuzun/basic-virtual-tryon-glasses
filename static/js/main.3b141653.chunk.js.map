{"version":3,"sources":["engine/constants.js","engine/helpers.js","engine/glasses.js","engine/index.js","engine/scene.js","engine/occluder.js","components/TryOn.js","components/App.js","serviceWorker.js","index.js"],"names":["LM","FACE_OVAL","CFG","clamp","v","lo","hi","Math","max","min","toV","pts","i","THREE","mid","a","b","clone","add","multiplyScalar","eyeMid","inner","outer","rrShape","w","h","r","oy","s","x0","x1","y0","y1","moveTo","lineTo","quadraticCurveTo","createSunglasses","g","frameMat","color","metalness","roughness","side","lensMat","transparent","opacity","depthWrite","lensW","lensH","holes","push","p","rrPath","fGeom","depth","bevelEnabled","bevelThickness","bevelSize","bevelSegments","computeVertexNormals","lf","position","set","bridgeW","rf","lGeom","lensR","ll","rl","bGeo","br","tGeo","ltPivot","cx","lt","rotation","y","rtPivot","rt","npMat","npGeo","lnp","rnp","traverse","c","isMesh","renderOrder","faceLandmarker","glassesObj","faceObj","bg","video","renderer","camera","scene","predictionInFlight","sm","ready","gPos","gQuat","gScale","prev","animate","needsUpdate","requestAnimationFrame","render","initializeThreejs","objName","document","getElementById","container","vw","videoWidth","vh","videoHeight","cam","createCamera","bgResult","minFilter","sprite","map","center","scale","copy","z","createVideoBackground","key","fill","rim","createLights","forEach","light","nOval","length","positions","Float32Array","indices","geo","setAttribute","setIndex","mat","colorWrite","mesh","frustumCulled","createDynamicFaceMesh","visible","antialias","alpha","preserveDrawingBuffer","setPixelRatio","window","devicePixelRatio","setSize","physicallyCorrectLights","toneMapping","toneMappingExposure","outputEncoding","createRenderer","appendChild","domElement","addEventListener","left","right","top","bottom","updateProjectionMatrix","handleResize","scheduleNextPrediction","requestVideoFrameCallback","renderPrediction","results","detectForVideo","performance","now","faceLandmarks","landmarks","l","x","toPixels","lEye","rEye","nose","nTip","fHead","chn","lTmp","rTmp","lChk","rChk","eMid","eW","distanceTo","tW","cW","fW","fH","xAxis","sub","normalize","yRaw","zAxis","cross","negate","yAxis","rotMat","makeBasis","targetQuat","setFromRotationMatrix","flipZ","setFromAxisAngle","PI","multiply","depAdj","tGPos","addScaledVector","gS","tGScale","mov","aDelta","acos","abs","dot","aP","aR","aS","lerp","slerp","quaternion","updateWorldMatrix","posAttr","geometry","getAttribute","cy","cz","fi","fv","setXYZ","coneD","TryOn","isLoading","setIsLoading","useState","isRecording","setIsRecording","recorderRef","useRef","chunksRef","useEffect","async","navigator","mediaDevices","getUserMedia","audio","facingMode","then","stream","srcObject","oncanplay","play","vision","import","fileset","FilesetResolver","forVisionTasks","FaceLandmarker","createFromOptions","baseOptions","modelAssetPath","delegate","runningMode","numFaces","outputFaceBlendshapes","outputFacialTransformationMatrixes","initializeEngine","init","handleScreenshot","useCallback","canvas","querySelector","link","createElement","download","Date","href","toDataURL","click","handleRecord","current","state","stop","captureStream","mimeType","MediaRecorder","isTypeSupported","recorder","ondataavailable","e","data","size","onstop","blob","Blob","type","url","URL","createObjectURL","revokeObjectURL","start","React","className","id","onClick","title","width","height","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","rx","App","Boolean","location","hostname","match","ReactDOM","serviceWorker","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.3b141653.chunk.js","sourcesContent":["/**\n * Landmark indices for key facial features.\n * Used to extract specific points from MediaPipe's 468-landmark face mesh.\n */\nexport const LM = {\n    leftEyeOuter: 33,\n    rightEyeOuter: 263,\n    leftEyeInner: 133,\n    rightEyeInner: 362,\n    leftTemple: 127,\n    rightTemple: 356,\n    leftCheek: 234,\n    rightCheek: 454,\n    forehead: 10,\n    chin: 175,\n    noseBridge: 168,\n    noseTip: 1\n};\n\n/**\n * Face oval contour — 36 landmarks tracing the face outline.\n * Used to build the dynamic face mesh occluder each frame.\n */\nexport const FACE_OVAL = [\n    10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288,\n    397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136,\n    172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109\n];\n\n/**\n * Calibration parameters.\n * Adjust these to fine-tune glasses placement and scale.\n */\nexport const CFG = {\n    refHeadWidth: 140,      // Reference head width (pixels) for scale normalization\n    refFaceHeight: 210,     // Reference face height (pixels)\n    glassesDepth: 10,       // Z-offset: how far glasses sit in front of the face\n    glassesDown: 2,         // Y-offset: push glasses slightly downward\n    glassesCenterX: 0,      // X-offset: horizontal fine-tuning\n    glassesScale: 1.05      // Overall scale multiplier\n};\n","import * as THREE from 'three';\n\n/** Clamp value between lo and hi. */\nexport function clamp(v, lo, hi) {\n    return Math.max(lo, Math.min(hi, v));\n}\n\n/** Convert landmark pixel coords to negated Three.js Vector3. */\nexport function toV(pts, i) {\n    return new THREE.Vector3(-pts[i][0], -pts[i][1], -pts[i][2]);\n}\n\n/** Midpoint of two Vector3s. */\nexport function mid(a, b) {\n    return a.clone().add(b).multiplyScalar(0.5);\n}\n\n/** Midpoint between inner and outer eye landmarks. */\nexport function eyeMid(pts, inner, outer) {\n    return mid(toV(pts, inner), toV(pts, outer));\n}\n\n/** Angular delta between two quaternions (radians). */\nexport function qDelta(a, b) {\n    return 2 * Math.acos(clamp(Math.abs(a.dot(b)), 0, 1));\n}\n\n/** Convert normalized MediaPipe landmarks to pixel coordinates. */\nexport function toPixels(landmarks, video) {\n    var w = video.videoWidth, h = video.videoHeight;\n    return landmarks.map(function(l) {\n        return [l.x * w, l.y * h, l.z * w];\n    });\n}\n\n/** Create a rounded rectangle Shape (for extrusion). */\nexport function rrShape(w, h, r, oy) {\n    oy = oy || 0;\n    var s = new THREE.Shape();\n    var x0 = -w / 2, x1 = w / 2;\n    var y0 = -h / 2 + oy, y1 = h / 2 + oy;\n    r = Math.min(r, w / 2, h / 2);\n    s.moveTo(x0 + r, y0);\n    s.lineTo(x1 - r, y0);\n    s.quadraticCurveTo(x1, y0, x1, y0 + r);\n    s.lineTo(x1, y1 - r);\n    s.quadraticCurveTo(x1, y1, x1 - r, y1);\n    s.lineTo(x0 + r, y1);\n    s.quadraticCurveTo(x0, y1, x0, y1 - r);\n    s.lineTo(x0, y0 + r);\n    s.quadraticCurveTo(x0, y0, x0 + r, y0);\n    return s;\n}\n\n/** Create a rounded rectangle Path (for hole cutouts). */\nexport function rrPath(w, h, r, oy) {\n    oy = oy || 0;\n    var p = new THREE.Path();\n    var x0 = -w / 2, x1 = w / 2;\n    var y0 = -h / 2 + oy, y1 = h / 2 + oy;\n    r = Math.min(r, w / 2, h / 2);\n    p.moveTo(x0 + r, y0);\n    p.lineTo(x1 - r, y0);\n    p.quadraticCurveTo(x1, y0, x1, y0 + r);\n    p.lineTo(x1, y1 - r);\n    p.quadraticCurveTo(x1, y1, x1 - r, y1);\n    p.lineTo(x0 + r, y1);\n    p.quadraticCurveTo(x0, y1, x0, y1 - r);\n    p.lineTo(x0, y0 + r);\n    p.quadraticCurveTo(x0, y0, x0 + r, y0);\n    return p;\n}\n","import * as THREE from 'three';\nimport { rrShape, rrPath } from './helpers';\n\n/**\n * Create a procedural wayfarer-style sunglasses model.\n * Returns a THREE.Group with all meshes at renderOrder = 3.\n *\n * To customize: adjust dimensions, materials, or swap this function entirely\n * with your own model loader (e.g., GLTFLoader).\n */\nexport function createSunglasses() {\n    var g = new THREE.Group();\n\n    // ── Dimensions (model units ≈ mm) ──\n    var lensW = 58, lensH = 34;\n    var ftTop = 8, ftBot = 3, ftSide = 4;\n    var bridgeW = 14, fd = 6;\n    var tLen = 50, tW = 4.5, tH = 3;\n    var lensR = 5, frameR = 6;\n\n    // ── Materials ──\n    var frameMat = new THREE.MeshStandardMaterial({\n        color: 0x0a0a12,\n        metalness: 0.25,\n        roughness: 0.25,\n        side: THREE.FrontSide\n    });\n\n    var lensMat = new THREE.MeshStandardMaterial({\n        color: 0x1a1a1a,\n        metalness: 0.1,\n        roughness: 0.05,\n        transparent: true,\n        opacity: 0.6,\n        side: THREE.DoubleSide,\n        depthWrite: false\n    });\n\n    // ── Frame (extruded rounded rect with lens hole) ──\n    var oW = lensW + ftSide * 2;\n    var oH = lensH + ftTop + ftBot;\n    var vOff = (ftTop - ftBot) / 2;\n\n    var outer = rrShape(oW, oH, frameR, vOff);\n    outer.holes.push(rrPath(lensW, lensH, lensR));\n\n    var fGeom = new THREE.ExtrudeBufferGeometry(outer, {\n        depth: fd,\n        bevelEnabled: true,\n        bevelThickness: 0.8,\n        bevelSize: 0.6,\n        bevelSegments: 2\n    });\n    fGeom.computeVertexNormals();\n\n    var cx = bridgeW / 2 + oW / 2;\n\n    var lf = new THREE.Mesh(fGeom, frameMat);\n    lf.position.set(-cx, 0, -fd / 2);\n    var rf = new THREE.Mesh(fGeom.clone(), frameMat);\n    rf.position.set(cx, 0, -fd / 2);\n\n    // ── Lenses ──\n    var lGeom = new THREE.ShapeBufferGeometry(\n        rrShape(lensW - 0.5, lensH - 0.5, lensR - 0.3), 12\n    );\n    var ll = new THREE.Mesh(lGeom, lensMat);\n    ll.position.set(-cx, 0, 0.5);\n    var rl = new THREE.Mesh(lGeom.clone(), lensMat);\n    rl.position.set(cx, 0, 0.5);\n\n    // ── Bridge ──\n    var bGeo = new THREE.BoxBufferGeometry(bridgeW + ftSide, 3.5, fd * 0.7);\n    var br = new THREE.Mesh(bGeo, frameMat);\n    br.position.set(0, lensH * 0.15 + vOff, 0);\n\n    // ── Temple arms (with outward splay via pivot groups) ──\n    var tGeo = new THREE.BoxBufferGeometry(tW, tH, tLen);\n    var tOutX = cx + oW / 2 - ftSide / 2;\n    var tY = lensH * 0.15 + vOff;\n    var tSplay = 0.08; // ~4.6° outward\n\n    var ltPivot = new THREE.Group();\n    ltPivot.position.set(-tOutX, tY, -fd / 2);\n    var lt = new THREE.Mesh(tGeo, frameMat);\n    lt.position.set(0, 0, -tLen / 2);\n    ltPivot.add(lt);\n    ltPivot.rotation.y = -tSplay;\n\n    var rtPivot = new THREE.Group();\n    rtPivot.position.set(tOutX, tY, -fd / 2);\n    var rt = new THREE.Mesh(tGeo.clone(), frameMat);\n    rt.position.set(0, 0, -tLen / 2);\n    rtPivot.add(rt);\n    rtPivot.rotation.y = tSplay;\n\n    // ── Nose pads ──\n    var npMat = new THREE.MeshStandardMaterial({\n        color: 0xbbbbbb, metalness: 0, roughness: 0.6,\n        transparent: true, opacity: 0.4\n    });\n    var npGeo = new THREE.SphereBufferGeometry(2.5, 8, 6);\n    var lnp = new THREE.Mesh(npGeo, npMat);\n    lnp.position.set(-bridgeW / 2 + 1, -lensH * 0.22, fd * 0.15);\n    var rnp = new THREE.Mesh(npGeo, npMat);\n    rnp.position.set(bridgeW / 2 - 1, -lensH * 0.22, fd * 0.15);\n\n    // ── Assemble ──\n    g.add(lf, rf, ll, rl, br, ltPivot, rtPivot, lnp, rnp);\n\n    g.traverse(function(c) {\n        if (c.isMesh) c.renderOrder = 3;\n    });\n\n    return g;\n}\n","/**\n * Virtual Try-On Engine\n *\n * Orchestrates the Three.js scene, MediaPipe face tracking, and per-frame\n * glasses placement. All shared state lives in this module; sub-modules\n * (glasses, occluder, scene, helpers) are stateless factories.\n *\n * Public API:\n *   initializeThreejs(objName) — set up scene, camera, models\n *   initializeEngine()         — load MediaPipe and start prediction loop\n */\n\nimport * as THREE from 'three';\nimport { CFG, LM, FACE_OVAL } from './constants';\nimport { clamp, toV, mid, eyeMid, qDelta, toPixels } from './helpers';\nimport { createSunglasses } from './glasses';\nimport { createDynamicFaceMesh } from './occluder';\nimport { createCamera, createVideoBackground, createLights, createRenderer, handleResize } from './scene';\n\n// ── Private State ────────────────────────────────────────────────────────────\nvar faceLandmarker;\nvar glassesObj;\nvar faceObj;\nvar bg;\nvar video;\nvar renderer;\nvar camera;\nvar scene;\nlet predictionInFlight = false;\n\nconst sm = {\n    ready: false,\n    gPos: new THREE.Vector3(),\n    gQuat: new THREE.Quaternion(),\n    gScale: new THREE.Vector3(1, 1, 1),\n    prev: new THREE.Vector3()\n};\n\n// ── Animation Loop ───────────────────────────────────────────────────────────\nfunction animate() {\n    bg.needsUpdate = true;\n    requestAnimationFrame(animate);\n    renderer.render(scene, camera);\n}\n\n// ── Public: Initialize Three.js Scene ────────────────────────────────────────\nexport function initializeThreejs(objName) {\n    video = document.getElementById('tryon-video');\n    var container = document.getElementById('threejsContainer');\n\n    // Camera\n    camera = createCamera(video);\n\n    // Video background\n    var bgResult = createVideoBackground(video, camera);\n    bg = bgResult.bg;\n\n    // Scene\n    scene = new THREE.Scene();\n    scene.add(bgResult.sprite);\n\n    // Lights\n    createLights().forEach(function(light) { scene.add(light); });\n\n    // Face mesh occluder\n    faceObj = createDynamicFaceMesh();\n    faceObj.visible = false;\n    scene.add(faceObj);\n\n    // Glasses model\n    glassesObj = createSunglasses();\n    glassesObj.visible = false;\n    scene.add(glassesObj);\n\n    // Renderer\n    renderer = createRenderer(video);\n    container.appendChild(renderer.domElement);\n\n    window.addEventListener('resize', function() {\n        handleResize(camera, renderer, video);\n    }, false);\n\n    animate();\n}\n\n// ── Public: Initialize MediaPipe Face Tracking ───────────────────────────────\nexport async function initializeEngine() {\n    var vision = await import(\n        /* webpackIgnore: true */\n        'https://unpkg.com/@mediapipe/tasks-vision@0.10.7/vision_bundle.mjs'\n    );\n    var fileset = await vision.FilesetResolver.forVisionTasks(\n        'https://unpkg.com/@mediapipe/tasks-vision@0.10.7/wasm'\n    );\n    faceLandmarker = await vision.FaceLandmarker.createFromOptions(fileset, {\n        baseOptions: {\n            modelAssetPath: 'https://storage.googleapis.com/mediapipe-assets/face_landmarker.task',\n            delegate: 'GPU'\n        },\n        runningMode: 'VIDEO',\n        numFaces: 1,\n        outputFaceBlendshapes: false,\n        outputFacialTransformationMatrixes: false\n    });\n    scheduleNextPrediction();\n}\n\n// Backward-compatible aliases (legacy function names)\nexport { initializeThreejs as IntializeThreejs };\nexport { initializeEngine as IntializeEngine };\n\n// ── Prediction Scheduling ────────────────────────────────────────────────────\nfunction scheduleNextPrediction() {\n    if (!video) {\n        requestAnimationFrame(scheduleNextPrediction);\n        return;\n    }\n    if (typeof video.requestVideoFrameCallback === 'function') {\n        video.requestVideoFrameCallback(function() { renderPrediction(); });\n    } else {\n        requestAnimationFrame(renderPrediction);\n    }\n}\n\n// ── Per-Frame Prediction ─────────────────────────────────────────────────────\nfunction renderPrediction() {\n    if (predictionInFlight) {\n        scheduleNextPrediction();\n        return;\n    }\n    predictionInFlight = true;\n\n    if (!faceLandmarker) {\n        predictionInFlight = false;\n        scheduleNextPrediction();\n        return;\n    }\n\n    var results = faceLandmarker.detectForVideo(video, performance.now());\n\n    if (results.faceLandmarks && results.faceLandmarks.length > 0 && glassesObj) {\n        glassesObj.visible = true;\n        if (faceObj) faceObj.visible = true;\n\n        var pts = toPixels(results.faceLandmarks[0], video);\n\n        // ── Key landmarks ──\n        var lEye = eyeMid(pts, LM.leftEyeInner, LM.leftEyeOuter);\n        var rEye = eyeMid(pts, LM.rightEyeInner, LM.rightEyeOuter);\n        var nose = toV(pts, LM.noseBridge);\n        var nTip = toV(pts, LM.noseTip);\n        var fHead = toV(pts, LM.forehead);\n        var chn = toV(pts, LM.chin);\n        var lTmp = toV(pts, LM.leftTemple);\n        var rTmp = toV(pts, LM.rightTemple);\n        var lChk = toV(pts, LM.leftCheek);\n        var rChk = toV(pts, LM.rightCheek);\n\n        var eMid = mid(lEye, rEye);\n\n        // ── Face measurements ──\n        var eW = lEye.distanceTo(rEye);\n        var tW = lTmp.distanceTo(rTmp);\n        var cW = lChk.distanceTo(rChk);\n        var fW = Math.max(eW, tW, cW);\n        var fH = fHead.distanceTo(chn);\n\n        // ── Orientation (landmark-based) ──\n        var xAxis = rEye.clone().sub(lEye).normalize();\n        var yRaw = fHead.clone().sub(chn).normalize();\n        var zAxis = xAxis.clone().cross(yRaw).normalize();\n\n        if (zAxis.z < 0) zAxis.negate();\n\n        var yAxis = zAxis.clone().cross(xAxis).normalize();\n\n        var rotMat = new THREE.Matrix4().makeBasis(xAxis, yAxis, zAxis);\n        var targetQuat = new THREE.Quaternion().setFromRotationMatrix(rotMat);\n\n        // Z-flip (model faces +Z but scene uses -Z for \"behind\")\n        var flipZ = new THREE.Quaternion().setFromAxisAngle(\n            new THREE.Vector3(0, 0, 1), Math.PI\n        );\n        targetQuat.multiply(flipZ);\n\n        // ── Position ──\n        var btt = nTip.clone().sub(nose);\n        var depAdj = clamp(btt.length() * 0.1, 0, 6);\n\n        var tGPos = eMid.clone()\n            .addScaledVector(xAxis, CFG.glassesCenterX)\n            .addScaledVector(yAxis, CFG.glassesDown)\n            .addScaledVector(zAxis, CFG.glassesDepth + depAdj);\n\n        // ── Scale ──\n        var wS = fW / CFG.refHeadWidth;\n        var hS = fH / CFG.refFaceHeight;\n        var bS = (wS * 0.7) + (hS * 0.3);\n        var gS = bS * CFG.glassesScale;\n\n        var tGScale = new THREE.Vector3(gS, gS, gS);\n\n        // ── Adaptive smoothing ──\n        var mov = tGPos.distanceTo(sm.prev);\n        var aDelta = qDelta(sm.gQuat, targetQuat);\n\n        var aP = clamp(0.12 + mov * 0.012, 0.12, 0.5);\n        var aR = clamp(0.12 + aDelta * 0.4, 0.12, 0.55);\n        var aS = clamp(0.14 + mov * 0.008, 0.14, 0.4);\n\n        if (!sm.ready) {\n            sm.gPos.copy(tGPos);\n            sm.gQuat.copy(targetQuat);\n            sm.gScale.copy(tGScale);\n            sm.ready = true;\n        } else {\n            sm.gPos.lerp(tGPos, aP);\n            sm.gQuat.slerp(targetQuat, aR);\n            sm.gScale.lerp(tGScale, aS);\n        }\n\n        sm.prev.copy(tGPos);\n\n        // ── Apply to glasses ──\n        glassesObj.position.copy(sm.gPos);\n        glassesObj.quaternion.copy(sm.gQuat);\n        glassesObj.scale.copy(sm.gScale);\n        glassesObj.updateWorldMatrix(true, true);\n\n        // ── Update face mesh occluder ──\n        if (faceObj) {\n            var posAttr = faceObj.geometry.getAttribute('position');\n            var cx = 0, cy = 0, cz = 0;\n            var fwdOff = 8;\n            for (var fi = 0; fi < FACE_OVAL.length; fi++) {\n                var fv = toV(pts, FACE_OVAL[fi]);\n                fv.addScaledVector(zAxis, fwdOff);\n                posAttr.setXYZ(fi + 1, fv.x, fv.y, fv.z);\n                cx += fv.x; cy += fv.y; cz += fv.z;\n            }\n            cx /= FACE_OVAL.length;\n            cy /= FACE_OVAL.length;\n            cz /= FACE_OVAL.length;\n\n            var coneD = fW * 0.5;\n            posAttr.setXYZ(0,\n                cx - zAxis.x * coneD,\n                cy - zAxis.y * coneD,\n                cz - zAxis.z * coneD\n            );\n            posAttr.needsUpdate = true;\n        }\n\n    } else {\n        if (glassesObj) glassesObj.visible = false;\n        if (faceObj) faceObj.visible = false;\n        sm.ready = false;\n    }\n\n    predictionInFlight = false;\n    scheduleNextPrediction();\n}\n","import * as THREE from 'three';\n\nconst CANVAS_WIDTH = 640;\n\n/** Create an orthographic camera sized to the video dimensions. */\nexport function createCamera(video) {\n    var vw = video.videoWidth;\n    var vh = video.videoHeight;\n    var cam = new THREE.OrthographicCamera(\n        -vw / 2, vw / 2,\n        vh / 2, -vh / 2,\n        0.1, 5000\n    );\n    cam.position.set(-vw / 2, -vh / 2, 500);\n    return cam;\n}\n\n/** Create the video background sprite and its texture. */\nexport function createVideoBackground(video, camera) {\n    var vw = video.videoWidth;\n    var vh = video.videoHeight;\n\n    var bg = new THREE.Texture(video);\n    bg.minFilter = THREE.LinearFilter;\n\n    var sprite = new THREE.Sprite(new THREE.MeshBasicMaterial({\n        map: bg,\n        depthWrite: false,\n        side: THREE.DoubleSide\n    }));\n    sprite.center.set(0.5, 0.5);\n    sprite.scale.set(-vw, vh, 1);\n    sprite.position.copy(camera.position);\n    sprite.position.z = 0;\n\n    return { bg, sprite };\n}\n\n/** Create the scene lighting (key, fill, rim, ambient). */\nexport function createLights() {\n    var key = new THREE.DirectionalLight(0xffffff, 1.1);\n    key.position.set(0, 100, 200);\n\n    var fill = new THREE.DirectionalLight(0xeeeeff, 0.45);\n    fill.position.set(-80, 30, 100);\n\n    var rim = new THREE.DirectionalLight(0xffffff, 0.3);\n    rim.position.set(60, 60, -80);\n\n    var amb = new THREE.HemisphereLight(0xffffff, 0x444444, 0.4);\n\n    return [key, fill, rim, amb];\n}\n\n/** Create the WebGL renderer with production-quality settings. */\nexport function createRenderer(video) {\n    var r = new THREE.WebGLRenderer({\n        antialias: true,\n        alpha: true,\n        preserveDrawingBuffer: true\n    });\n    r.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n    r.setSize(CANVAS_WIDTH, CANVAS_WIDTH * video.videoHeight / video.videoWidth);\n    r.physicallyCorrectLights = true;\n    r.toneMapping = THREE.ACESFilmicToneMapping;\n    r.toneMappingExposure = 1.1;\n    r.outputEncoding = THREE.sRGBEncoding;\n    return r;\n}\n\n/** Handle window resize for the orthographic camera. */\nexport function handleResize(camera, renderer, video) {\n    var vw = video.videoWidth, vh = video.videoHeight;\n    camera.left = -vw / 2;\n    camera.right = vw / 2;\n    camera.top = vh / 2;\n    camera.bottom = -vh / 2;\n    camera.updateProjectionMatrix();\n    renderer.setSize(CANVAS_WIDTH, CANVAS_WIDTH * vh / vw);\n}\n","import * as THREE from 'three';\nimport { FACE_OVAL } from './constants';\n\n/**\n * Create a dynamic face mesh occluder (triangle fan geometry).\n *\n * The mesh has 37 vertices: 36 face oval landmarks + 1 centroid center.\n * Vertices are updated every frame directly from landmark world coordinates\n * in the main prediction loop (see engine/index.js).\n *\n * Render order = 1 (before glasses at 3), colorWrite = false.\n * This writes only to the depth buffer, creating an invisible barrier\n * that hides temple arms behind the face.\n */\nexport function createDynamicFaceMesh() {\n    var nOval = FACE_OVAL.length;\n    var nVerts = nOval + 1;\n\n    var positions = new Float32Array(nVerts * 3);\n    var indices = [];\n\n    // Triangle fan: center (0) → oval[i] (i+1) → oval[next] (next+1)\n    for (var i = 0; i < nOval; i++) {\n        indices.push(0, i + 1, ((i + 1) % nOval) + 1);\n    }\n\n    var geo = new THREE.BufferGeometry();\n    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n    geo.setIndex(indices);\n\n    var mat = new THREE.MeshBasicMaterial({\n        colorWrite: false,\n        side: THREE.DoubleSide\n    });\n\n    var mesh = new THREE.Mesh(geo, mat);\n    mesh.renderOrder = 1;\n    mesh.frustumCulled = false;\n    return mesh;\n}\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\nimport '../style/TryOn.style.css';\nimport { initializeEngine, initializeThreejs } from '../engine';\n\nexport const TryOn = () => {\n    const [isLoading, setIsLoading] = useState(true);\n    const [isRecording, setIsRecording] = useState(false);\n    const recorderRef = useRef(null);\n    const chunksRef = useRef([]);\n\n    useEffect(() => {\n        async function init() {\n            var video = document.getElementById('tryon-video');\n\n            await navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: { facingMode: 'user' }\n            }).then(stream => {\n                video.srcObject = stream;\n            });\n\n            video.oncanplay = () => {\n                video.play();\n                initializeThreejs(\"glasses_premium.gltf\");\n                initializeEngine();\n                setIsLoading(false);\n            };\n        }\n\n        init();\n        return () => {};\n    }, []);\n\n    const handleScreenshot = useCallback(() => {\n        var canvas = document.querySelector('#threejsContainer canvas');\n        if (!canvas) return;\n        var link = document.createElement('a');\n        link.download = 'virtual-tryon-' + Date.now() + '.png';\n        link.href = canvas.toDataURL('image/png');\n        link.click();\n    }, []);\n\n    const handleRecord = useCallback(() => {\n        if (isRecording) {\n            if (recorderRef.current && recorderRef.current.state !== 'inactive') {\n                recorderRef.current.stop();\n            }\n            setIsRecording(false);\n            return;\n        }\n\n        var canvas = document.querySelector('#threejsContainer canvas');\n        if (!canvas) return;\n\n        chunksRef.current = [];\n        var stream = canvas.captureStream(30);\n        var mimeType = MediaRecorder.isTypeSupported('video/webm;codecs=vp9')\n            ? 'video/webm;codecs=vp9'\n            : 'video/webm';\n        var recorder = new MediaRecorder(stream, { mimeType: mimeType });\n\n        recorder.ondataavailable = function(e) {\n            if (e.data.size > 0) chunksRef.current.push(e.data);\n        };\n\n        recorder.onstop = function() {\n            var blob = new Blob(chunksRef.current, { type: 'video/webm' });\n            var url = URL.createObjectURL(blob);\n            var link = document.createElement('a');\n            link.download = 'virtual-tryon-' + Date.now() + '.webm';\n            link.href = url;\n            link.click();\n            URL.revokeObjectURL(url);\n        };\n\n        recorder.start();\n        recorderRef.current = recorder;\n        setIsRecording(true);\n    }, [isRecording]);\n\n    return (\n        <div className=\"tryon-page\">\n            <div className=\"tryon-header\">\n                <h1 className=\"tryon-title\">Virtual Try-On</h1>\n                <p className=\"tryon-subtitle\">AI-Powered Glasses Experience</p>\n            </div>\n\n            <div className=\"tryon-viewport\">\n                {isLoading && (\n                    <div className=\"tryon-loading\">\n                        <div className=\"tryon-spinner\"></div>\n                        <p>Initializing camera...</p>\n                    </div>\n                )}\n                <div id=\"threejsContainer\">\n                    <video id=\"tryon-video\"></video>\n                </div>\n            </div>\n\n            <div className=\"tryon-controls\">\n                <button className=\"tryon-btn\" onClick={handleScreenshot} title=\"Take Screenshot\">\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                        <path d=\"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z\"/>\n                        <circle cx=\"12\" cy=\"13\" r=\"4\"/>\n                    </svg>\n                    Screenshot\n                </button>\n                <button\n                    className={'tryon-btn tryon-btn-record' + (isRecording ? ' recording' : '')}\n                    onClick={handleRecord}\n                    title={isRecording ? 'Stop Recording' : 'Start Recording'}\n                >\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        {isRecording ? (\n                            <rect x=\"6\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" fill=\"currentColor\"/>\n                        ) : (\n                            <circle cx=\"12\" cy=\"12\" r=\"7\" fill=\"currentColor\"/>\n                        )}\n                    </svg>\n                    {isRecording ? 'Stop' : 'Record'}\n                </button>\n            </div>\n\n            <p className=\"tryon-footer\">Powered by MediaPipe + Three.js</p>\n        </div>\n    );\n};\n","import React from 'react';\nimport { TryOn } from './TryOn';\n\nexport default function App() {\n    return (\n        <div className=\"App\">\n            <TryOn />\n        </div>\n    );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './style/index.style.css';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.unregister();\n"],"sourceRoot":""}