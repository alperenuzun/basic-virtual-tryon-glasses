(this["webpackJsonpbasic-virtual-tryon-glasses"]=this["webpackJsonpbasic-virtual-tryon-glasses"]||[]).push([[0],[,,,,function(e,t,n){e.exports=n(11)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(3),i=n.n(o),s=(n(9),n(10),n(0));const c=33,l=263,d=133,u=362,m=127,v=356,p=234,h=454,w=10,g=175,y=168,f=1,b=[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],E=140,k=210,T=10,x=2,C=0,S=1.05;function M(e,t,n){return Math.max(t,Math.min(n,e))}function j(e,t){return new s.y(-e[t][0],-e[t][1],-e[t][2])}function z(e,t){return e.clone().add(t).multiplyScalar(.5)}function q(e,t,n){return z(j(e,t),j(e,n))}function F(e,t,n,a){a=a||0;var r=new s.t,o=-e/2,i=e/2,c=-t/2+a,l=t/2+a;return n=Math.min(n,e/2,t/2),r.moveTo(o+n,c),r.lineTo(i-n,c),r.quadraticCurveTo(i,c,i,c+n),r.lineTo(i,l-n),r.quadraticCurveTo(i,l,i-n,l),r.lineTo(o+n,l),r.quadraticCurveTo(o,l,o,l-n),r.lineTo(o,c+n),r.quadraticCurveTo(o,c,o+n,c),r}function O(){var e=new s.i,t=new s.o({color:657938,metalness:.25,roughness:.25,side:s.h}),n=new s.o({color:1710618,metalness:.1,roughness:.05,transparent:!0,opacity:.6,side:s.f,depthWrite:!1}),a=F(66,45,6,2.5);a.holes.push(function(e,t,n,a){a=a||0;var r=new s.q,o=-e/2,i=e/2,c=-t/2+a,l=t/2+a;return n=Math.min(n,e/2,t/2),r.moveTo(o+n,c),r.lineTo(i-n,c),r.quadraticCurveTo(i,c,i,c+n),r.lineTo(i,l-n),r.quadraticCurveTo(i,l,i-n,l),r.lineTo(o+n,l),r.quadraticCurveTo(o,l,o,l-n),r.lineTo(o,c+n),r.quadraticCurveTo(o,c,o+n,c),r}(58,34,5));var r=new s.g(a,{depth:6,bevelEnabled:!0,bevelThickness:.8,bevelSize:.6,bevelSegments:2});r.computeVertexNormals();var o=new s.m(r,t);o.position.set(-40,0,-3);var i=new s.m(r.clone(),t);i.position.set(40,0,-3);var c=new s.u(F(57.5,33.5,4.7),12),l=new s.m(c,n);l.position.set(-40,0,.5);var d=new s.m(c.clone(),n);d.position.set(40,0,.5);var u=new s.b(18,3.5,6*.7),m=new s.m(u,t);m.position.set(0,7.6,0);var v=new s.b(4.5,3,50),p=new s.i;p.position.set(-71,7.6,-3);var h=new s.m(v,t);h.position.set(0,0,-25),p.add(h),p.rotation.y=-.08;var w=new s.i;w.position.set(71,7.6,-3);var g=new s.m(v.clone(),t);g.position.set(0,0,-25),w.add(g),w.rotation.y=.08;var y=new s.o({color:12303291,metalness:0,roughness:.6,transparent:!0,opacity:.4}),f=new s.v(2.5,8,6),b=new s.m(f,y);b.position.set(-6,-7.48,6*.15);var E=new s.m(f,y);return E.position.set(6,-7.48,6*.15),e.add(o,i,l,d,m,p,w,b,E),e.traverse((function(e){e.isMesh&&(e.renderOrder=3)})),e}var R,L,N,P,W,A,V,B;let I=!1;const U={ready:!1,gPos:new s.y,gQuat:new s.r,gScale:new s.y(1,1,1),prev:new s.y};function D(){P.needsUpdate=!0,requestAnimationFrame(D),A.render(B,V)}function H(e){W=document.getElementById("tryon-video");var t=document.getElementById("threejsContainer");V=function(e){var t=e.videoWidth,n=e.videoHeight,a=new s.p(-t/2,t/2,n/2,-n/2,.1,5e3);return a.position.set(-t/2,-n/2,500),a}(W);var n=function(e,t){var n=e.videoWidth,a=e.videoHeight,r=new s.x(e);r.minFilter=s.k;var o=new s.w(new s.n({map:r,depthWrite:!1,side:s.f}));return o.center.set(.5,.5),o.scale.set(-n,a,1),o.position.copy(t.position),o.position.z=0,{bg:r,sprite:o}}(W,V);P=n.bg,(B=new s.s).add(n.sprite),function(){var e=new s.e(16777215,1.1);e.position.set(0,100,200);var t=new s.e(15658751,.45);t.position.set(-80,30,100);var n=new s.e(16777215,.3);return n.position.set(60,60,-80),[e,t,n,new s.j(16777215,4473924,.4)]}().forEach((function(e){B.add(e)})),(N=function(){for(var e=b.length,t=new Float32Array(3*(e+1)),n=[],a=0;a<e;a++)n.push(0,a+1,(a+1)%e+1);var r=new s.d;r.setAttribute("position",new s.c(t,3)),r.setIndex(n);var o=new s.n({colorWrite:!1,side:s.f}),i=new s.m(r,o);return i.renderOrder=1,i.frustumCulled=!1,i}()).visible=!1,B.add(N),(L=O()).visible=!1,B.add(L),A=function(e){var t=new s.z({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});return t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.setSize(640,640*e.videoHeight/e.videoWidth),t.physicallyCorrectLights=!0,t.toneMapping=s.a,t.toneMappingExposure=1.1,t.outputEncoding=s.A,t}(W),t.appendChild(A.domElement),window.addEventListener("resize",(function(){!function(e,t,n){var a=n.videoWidth,r=n.videoHeight;e.left=-a/2,e.right=a/2,e.top=r/2,e.bottom=-r/2,e.updateProjectionMatrix(),t.setSize(640,640*r/a)}(V,A,W)}),!1),D()}function Q(){W?"function"===typeof W.requestVideoFrameCallback?W.requestVideoFrameCallback((function(){G()})):requestAnimationFrame(G):requestAnimationFrame(Q)}function G(){if(I)Q();else{if(I=!0,!R)return I=!1,void Q();var e,t,n=R.detectForVideo(W,performance.now());if(n.faceLandmarks&&n.faceLandmarks.length>0&&L){L.visible=!0,N&&(N.visible=!0);var a=function(e,t){var n=t.videoWidth,a=t.videoHeight;return e.map((function(e){return[e.x*n,e.y*a,e.z*n]}))}(n.faceLandmarks[0],W),r=q(a,d,c),o=q(a,u,l),i=j(a,y),F=j(a,f),O=j(a,w),P=j(a,g),A=j(a,m),V=j(a,v),B=j(a,p),D=j(a,h),H=z(r,o),G=r.distanceTo(o),J=A.distanceTo(V),X=B.distanceTo(D),Y=Math.max(G,J,X),Z=O.distanceTo(P),_=o.clone().sub(r).normalize(),$=O.clone().sub(P).normalize(),K=_.clone().cross($).normalize();K.z<0&&K.negate();var ee=K.clone().cross(_).normalize(),te=(new s.l).makeBasis(_,ee,K),ne=(new s.r).setFromRotationMatrix(te),ae=(new s.r).setFromAxisAngle(new s.y(0,0,1),Math.PI);ne.multiply(ae);var re=M(.1*F.clone().sub(i).length(),0,6),oe=H.clone().addScaledVector(_,C).addScaledVector(ee,x).addScaledVector(K,T+re),ie=(.7*(Y/E)+.3*(Z/k))*S,se=new s.y(ie,ie,ie),ce=oe.distanceTo(U.prev),le=(e=U.gQuat,t=ne,2*Math.acos(M(Math.abs(e.dot(t)),0,1))),de=M(.12+.012*ce,.12,.5),ue=M(.12+.4*le,.12,.55),me=M(.14+.008*ce,.14,.4);if(U.ready?(U.gPos.lerp(oe,de),U.gQuat.slerp(ne,ue),U.gScale.lerp(se,me)):(U.gPos.copy(oe),U.gQuat.copy(ne),U.gScale.copy(se),U.ready=!0),U.prev.copy(oe),L.position.copy(U.gPos),L.quaternion.copy(U.gQuat),L.scale.copy(U.gScale),L.updateWorldMatrix(!0,!0),N){for(var ve=N.geometry.getAttribute("position"),pe=0,he=0,we=0,ge=0;ge<b.length;ge++){var ye=j(a,b[ge]);ye.addScaledVector(K,8),ve.setXYZ(ge+1,ye.x,ye.y,ye.z),pe+=ye.x,he+=ye.y,we+=ye.z}pe/=b.length,he/=b.length,we/=b.length;var fe=.5*Y;ve.setXYZ(0,pe-K.x*fe,he-K.y*fe,we-K.z*fe),ve.needsUpdate=!0}}else L&&(L.visible=!1),N&&(N.visible=!1),U.ready=!1;I=!1,Q()}}const J=()=>{const[e,t]=Object(a.useState)(!0),[n,o]=Object(a.useState)(!1),i=Object(a.useRef)(null),s=Object(a.useRef)([]);Object(a.useEffect)(()=>(async function(){var e=document.getElementById("tryon-video");await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}).then(t=>{e.srcObject=t}),e.oncanplay=()=>{e.play(),H(),async function(){var e=await import("https://unpkg.com/@mediapipe/tasks-vision@0.10.7/vision_bundle.mjs"),t=await e.FilesetResolver.forVisionTasks("https://unpkg.com/@mediapipe/tasks-vision@0.10.7/wasm");R=await e.FaceLandmarker.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-assets/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",numFaces:1,outputFaceBlendshapes:!1,outputFacialTransformationMatrixes:!1}),Q()}(),t(!1)}}(),()=>{}),[]);const c=Object(a.useCallback)(()=>{var e=document.querySelector("#threejsContainer canvas");if(e){var t=document.createElement("a");t.download="virtual-tryon-"+Date.now()+".png",t.href=e.toDataURL("image/png"),t.click()}},[]),l=Object(a.useCallback)(()=>{if(n)return i.current&&"inactive"!==i.current.state&&i.current.stop(),void o(!1);var e=document.querySelector("#threejsContainer canvas");if(e){s.current=[];var t=e.captureStream(30),a=MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?"video/webm;codecs=vp9":"video/webm",r=new MediaRecorder(t,{mimeType:a});r.ondataavailable=function(e){e.data.size>0&&s.current.push(e.data)},r.onstop=function(){var e=new Blob(s.current,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");n.download="virtual-tryon-"+Date.now()+".webm",n.href=t,n.click(),URL.revokeObjectURL(t)},r.start(),i.current=r,o(!0)}},[n]);return r.a.createElement("div",{className:"tryon-page"},r.a.createElement("div",{className:"tryon-header"},r.a.createElement("h1",{className:"tryon-title"},"Virtual Try-On"),r.a.createElement("p",{className:"tryon-subtitle"},"AI-Powered Glasses Experience")),r.a.createElement("div",{className:"tryon-viewport"},e&&r.a.createElement("div",{className:"tryon-loading"},r.a.createElement("div",{className:"tryon-spinner"}),r.a.createElement("p",null,"Initializing camera...")),r.a.createElement("div",{id:"threejsContainer"},r.a.createElement("video",{id:"tryon-video"}))),r.a.createElement("div",{className:"tryon-controls"},r.a.createElement("button",{className:"tryon-btn",onClick:c,title:"Take Screenshot"},r.a.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},r.a.createElement("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),r.a.createElement("circle",{cx:"12",cy:"13",r:"4"})),"Screenshot"),r.a.createElement("button",{className:"tryon-btn tryon-btn-record"+(n?" recording":""),onClick:l,title:n?"Stop Recording":"Start Recording"},r.a.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},n?r.a.createElement("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2",fill:"currentColor"}):r.a.createElement("circle",{cx:"12",cy:"12",r:"7",fill:"currentColor"})),n?"Stop":"Record")),r.a.createElement("p",{className:"tryon-footer"},"Powered by MediaPipe + Three.js"))};function X(){return r.a.createElement("div",{className:"App"},r.a.createElement(J,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}],[[4,1,2]]]);
//# sourceMappingURL=main.3b141653.chunk.js.map