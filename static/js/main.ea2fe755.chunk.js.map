{"version":3,"sources":["engine/constants.js","engine/helpers.js","engine/glasses.js","engine/index.js","engine/scene.js","engine/occluder.js","components/TryOn.js","components/App.js","serviceWorker.js","index.js"],"names":["LM","FACE_OVAL","CFG","clamp","v","lo","hi","Math","max","min","toV","pts","i","THREE","mid","a","b","clone","add","multiplyScalar","eyeMid","inner","outer","createSunglasses","g","acetateMat","color","metalness","roughness","clearcoat","clearcoatRoughness","reflectivity","side","goldMat","goldDarkMat","lensMat","transparent","opacity","depthWrite","envMapIntensity","buildRim","xOff","curve","w","h","segments","PI","push","cos","sin","ellipseCurve3D","geo","mesh","position","x","buildLens","shape","absellipse","lensW","lensH","set","bridgeGap","bridgePts","wireR","cx","bridgeCurve","bridgeGeo","buildTemple","pivot","hingeX","armPath","armGeo","tipPath","tipGeo","rotation","y","buildHinge","hg","barrelGeo","barrel","plateGeo","plate","screwGeo","screw","traverse","child","isMesh","renderOrder","faceLandmarker","glassesObj","faceObj","bg","video","renderer","camera","scene","predictionInFlight","sm","ready","gPos","gQuat","gScale","prev","animate","needsUpdate","requestAnimationFrame","render","initializeThreejs","objName","document","getElementById","container","vw","videoWidth","vh","videoHeight","cam","createCamera","bgResult","minFilter","sprite","map","center","scale","copy","z","createVideoBackground","r","antialias","alpha","preserveDrawingBuffer","setPixelRatio","window","devicePixelRatio","setSize","physicallyCorrectLights","toneMapping","toneMappingExposure","outputEncoding","createRenderer","appendChild","domElement","pmrem","compileCubemapShader","neutralEnv","fromScene","texture","environment","dispose","key","fill","rim","topAccent","createLights","forEach","light","nOval","length","positions","Float32Array","indices","setAttribute","setIndex","mat","colorWrite","frustumCulled","createDynamicFaceMesh","visible","addEventListener","left","right","top","bottom","updateProjectionMatrix","handleResize","scheduleNextPrediction","requestVideoFrameCallback","renderPrediction","results","detectForVideo","performance","now","faceLandmarks","landmarks","l","toPixels","lEye","rEye","nose","nTip","fHead","chn","lTmp","rTmp","lChk","rChk","eMid","eW","distanceTo","tW","cW","fW","fH","xAxis","sub","normalize","yRaw","zAxis","cross","negate","yAxis","rotMat","makeBasis","targetQuat","setFromRotationMatrix","flipZ","setFromAxisAngle","multiply","depAdj","tGPos","addScaledVector","gS","tGScale","mov","aDelta","acos","abs","dot","aP","aR","aS","lerp","slerp","quaternion","updateWorldMatrix","posAttr","geometry","getAttribute","cy","cz","fi","fv","setXYZ","coneD","TryOn","isLoading","setIsLoading","useState","isRecording","setIsRecording","recorderRef","useRef","chunksRef","useEffect","async","navigator","mediaDevices","getUserMedia","audio","facingMode","then","stream","srcObject","oncanplay","play","vision","import","fileset","FilesetResolver","forVisionTasks","FaceLandmarker","createFromOptions","baseOptions","modelAssetPath","delegate","runningMode","numFaces","outputFaceBlendshapes","outputFacialTransformationMatrixes","initializeEngine","init","handleScreenshot","useCallback","canvas","querySelector","link","createElement","download","Date","href","toDataURL","click","handleRecord","current","state","stop","captureStream","mimeType","MediaRecorder","isTypeSupported","recorder","ondataavailable","e","data","size","onstop","blob","Blob","type","url","URL","createObjectURL","revokeObjectURL","start","React","className","id","onClick","title","width","height","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","rx","App","Boolean","location","hostname","match","ReactDOM","serviceWorker","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.ea2fe755.chunk.js","sourcesContent":["/**\n * Landmark indices for key facial features.\n * Used to extract specific points from MediaPipe's 468-landmark face mesh.\n */\nexport const LM = {\n    leftEyeOuter: 33,\n    rightEyeOuter: 263,\n    leftEyeInner: 133,\n    rightEyeInner: 362,\n    leftTemple: 127,\n    rightTemple: 356,\n    leftCheek: 234,\n    rightCheek: 454,\n    forehead: 10,\n    chin: 175,\n    noseBridge: 168,\n    noseTip: 1\n};\n\n/**\n * Face oval contour — 36 landmarks tracing the face outline.\n * Used to build the dynamic face mesh occluder each frame.\n */\nexport const FACE_OVAL = [\n    10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288,\n    397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136,\n    172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109\n];\n\n/**\n * Calibration parameters.\n * Adjust these to fine-tune glasses placement and scale.\n */\nexport const CFG = {\n    refHeadWidth: 140,      // Reference head width (pixels) for scale normalization\n    refFaceHeight: 210,     // Reference face height (pixels)\n    glassesDepth: 10,       // Z-offset: how far glasses sit in front of the face\n    glassesDown: 2,         // Y-offset: push glasses slightly downward\n    glassesCenterX: 0,      // X-offset: horizontal fine-tuning\n    glassesScale: 1.22      // Overall scale multiplier\n};\n","import * as THREE from 'three';\n\n/** Clamp value between lo and hi. */\nexport function clamp(v, lo, hi) {\n    return Math.max(lo, Math.min(hi, v));\n}\n\n/** Convert landmark pixel coords to negated Three.js Vector3. */\nexport function toV(pts, i) {\n    return new THREE.Vector3(-pts[i][0], -pts[i][1], -pts[i][2]);\n}\n\n/** Midpoint of two Vector3s. */\nexport function mid(a, b) {\n    return a.clone().add(b).multiplyScalar(0.5);\n}\n\n/** Midpoint between inner and outer eye landmarks. */\nexport function eyeMid(pts, inner, outer) {\n    return mid(toV(pts, inner), toV(pts, outer));\n}\n\n/** Angular delta between two quaternions (radians). */\nexport function qDelta(a, b) {\n    return 2 * Math.acos(clamp(Math.abs(a.dot(b)), 0, 1));\n}\n\n/** Convert normalized MediaPipe landmarks to pixel coordinates. */\nexport function toPixels(landmarks, video) {\n    var w = video.videoWidth, h = video.videoHeight;\n    return landmarks.map(function(l) {\n        return [l.x * w, l.y * h, l.z * w];\n    });\n}\n\n/** Create a rounded rectangle Shape (for extrusion). */\nexport function rrShape(w, h, r, oy) {\n    oy = oy || 0;\n    var s = new THREE.Shape();\n    var x0 = -w / 2, x1 = w / 2;\n    var y0 = -h / 2 + oy, y1 = h / 2 + oy;\n    r = Math.min(r, w / 2, h / 2);\n    s.moveTo(x0 + r, y0);\n    s.lineTo(x1 - r, y0);\n    s.quadraticCurveTo(x1, y0, x1, y0 + r);\n    s.lineTo(x1, y1 - r);\n    s.quadraticCurveTo(x1, y1, x1 - r, y1);\n    s.lineTo(x0 + r, y1);\n    s.quadraticCurveTo(x0, y1, x0, y1 - r);\n    s.lineTo(x0, y0 + r);\n    s.quadraticCurveTo(x0, y0, x0 + r, y0);\n    return s;\n}\n\n/** Create a rounded rectangle Path (for hole cutouts). */\nexport function rrPath(w, h, r, oy) {\n    oy = oy || 0;\n    var p = new THREE.Path();\n    var x0 = -w / 2, x1 = w / 2;\n    var y0 = -h / 2 + oy, y1 = h / 2 + oy;\n    r = Math.min(r, w / 2, h / 2);\n    p.moveTo(x0 + r, y0);\n    p.lineTo(x1 - r, y0);\n    p.quadraticCurveTo(x1, y0, x1, y0 + r);\n    p.lineTo(x1, y1 - r);\n    p.quadraticCurveTo(x1, y1, x1 - r, y1);\n    p.lineTo(x0 + r, y1);\n    p.quadraticCurveTo(x0, y1, x0, y1 - r);\n    p.lineTo(x0, y0 + r);\n    p.quadraticCurveTo(x0, y0, x0 + r, y0);\n    return p;\n}\n","import * as THREE from 'three';\n\n/**\n * Create a premium wire-frame sunglasses model.\n * Entirely procedural — no external assets needed.\n *\n * Style: Clean gold wire-rim with dark Havana acetate temple tips\n *   - Gold metal wire rim around each lens\n *   - G-15 green-grey tinted lenses\n *   - Gold arched bridge\n *   - Straight gold tubular temple arms with acetate end tips\n *   - Gold hinge details\n *\n * Returns a THREE.Group with all meshes at renderOrder = 3.\n */\nexport function createSunglasses() {\n    var g = new THREE.Group();\n\n    // ══════════════════════════════════════════════════════════════════════\n    // DIMENSIONS (model-space ≈ mm)\n    // ══════════════════════════════════════════════════════════════════════\n    var lensW      = 52;    // lens width\n    var lensH      = 43;    // lens height\n    var bridgeGap  = 17;    // horizontal space between lens centers\n    var wireR      = 0.7;   // metal rim wire radius\n    var templeLen  = 56;    // temple arm length\n\n    // X-center of each lens\n    var cx = bridgeGap / 2 + lensW / 2 + 1.5;\n\n    // ══════════════════════════════════════════════════════════════════════\n    // MATERIALS\n    // ══════════════════════════════════════════════════════════════════════\n\n    // Dark Havana acetate — for temple tips only\n    var acetateMat = new THREE.MeshPhysicalMaterial({\n        color: 0x3d1f0d,\n        metalness: 0.0,\n        roughness: 0.16,\n        clearcoat: 0.95,\n        clearcoatRoughness: 0.06,\n        reflectivity: 0.5,\n        side: THREE.DoubleSide\n    });\n\n    // Warm gold metal\n    var goldMat = new THREE.MeshStandardMaterial({\n        color: 0xc9a54e,\n        metalness: 0.92,\n        roughness: 0.12,\n        side: THREE.DoubleSide\n    });\n\n    // Darker gold for subtle details\n    var goldDarkMat = new THREE.MeshStandardMaterial({\n        color: 0xa08030,\n        metalness: 0.88,\n        roughness: 0.18,\n        side: THREE.FrontSide\n    });\n\n    // Classic G-15 green-grey lens tint\n    var lensMat = new THREE.MeshPhysicalMaterial({\n        color: 0x1c2e1c,\n        metalness: 0.05,\n        roughness: 0.02,\n        transparent: true,\n        opacity: 0.68,\n        side: THREE.DoubleSide,\n        depthWrite: false,\n        clearcoat: 1.0,\n        clearcoatRoughness: 0.03,\n        envMapIntensity: 0.3\n    });\n\n    // ══════════════════════════════════════════════════════════════════════\n    // HELPER: Elliptical curve (3D points for TubeGeometry)\n    // ══════════════════════════════════════════════════════════════════════\n    function ellipseCurve3D(w, h, segments) {\n        segments = segments || 72;\n        var pts = [];\n        for (var i = 0; i <= segments; i++) {\n            var a = (i / segments) * Math.PI * 2;\n            pts.push(new THREE.Vector3(\n                Math.cos(a) * w * 0.5,\n                Math.sin(a) * h * 0.5,\n                0\n            ));\n        }\n        return new THREE.CatmullRomCurve3(pts, true);\n    }\n\n    // ══════════════════════════════════════════════════════════════════════\n    // METAL WIRE RIM (full ellipse around each lens)\n    // ══════════════════════════════════════════════════════════════════════\n    function buildRim(xOff) {\n        var curve = ellipseCurve3D(lensW, lensH);\n        var geo = new THREE.TubeGeometry(curve, 72, wireR, 8, true);\n        var mesh = new THREE.Mesh(geo, goldMat);\n        mesh.position.x = xOff;\n        return mesh;\n    }\n\n    g.add(buildRim(-cx));\n    g.add(buildRim(cx));\n\n    // ══════════════════════════════════════════════════════════════════════\n    // LENSES (flat elliptical discs)\n    // ══════════════════════════════════════════════════════════════════════\n    function buildLens(xOff) {\n        var shape = new THREE.Shape();\n        shape.absellipse(0, 0, lensW * 0.485, lensH * 0.485, 0, Math.PI * 2, false, 0);\n        var geo = new THREE.ShapeGeometry(shape, 48);\n        var mesh = new THREE.Mesh(geo, lensMat);\n        mesh.position.set(xOff, 0, 0.2);\n        return mesh;\n    }\n\n    g.add(buildLens(-cx));\n    g.add(buildLens(cx));\n\n    // ══════════════════════════════════════════════════════════════════════\n    // METAL BRIDGE (gold wire connecting the two rims — arched)\n    // ══════════════════════════════════════════════════════════════════════\n    var bridgePts = [\n        new THREE.Vector3(-cx + lensW * 0.35, lensH * 0.08, wireR),\n        new THREE.Vector3(-bridgeGap * 0.25,  lensH * 0.18, wireR * 2),\n        new THREE.Vector3(0,                   lensH * 0.22, wireR * 2.5),\n        new THREE.Vector3( bridgeGap * 0.25,  lensH * 0.18, wireR * 2),\n        new THREE.Vector3( cx - lensW * 0.35, lensH * 0.08, wireR)\n    ];\n    var bridgeCurve = new THREE.CatmullRomCurve3(bridgePts);\n    var bridgeGeo = new THREE.TubeGeometry(bridgeCurve, 24, wireR * 1.2, 8, false);\n    g.add(new THREE.Mesh(bridgeGeo, goldMat));\n\n    // ══════════════════════════════════════════════════════════════════════\n    // TEMPLE ARMS — completely straight\n    // Thin gold metal tube + acetate end tip sleeve\n    // ══════════════════════════════════════════════════════════════════════\n    function buildTemple(side) {\n        var pivot = new THREE.Group();\n\n        var hingeX = side * (cx + lensW * 0.5 + 2.5);\n        var hingeY = lensH * 0.2;\n        pivot.position.set(hingeX, hingeY, 0);\n\n        // Perfectly straight path from hinge to tip\n        var armPath = new THREE.CatmullRomCurve3([\n            new THREE.Vector3(0, 0,  0),\n            new THREE.Vector3(0, 0, -templeLen * 0.5),\n            new THREE.Vector3(0, 0, -templeLen)\n        ]);\n\n        // Main gold metal arm\n        var armGeo = new THREE.TubeGeometry(armPath, 32, 1.0, 8, false);\n        pivot.add(new THREE.Mesh(armGeo, goldMat));\n\n        // Acetate end tip (thicker sleeve on last ~35%)\n        var tipPath = new THREE.CatmullRomCurve3([\n            new THREE.Vector3(0, 0, -templeLen * 0.65),\n            new THREE.Vector3(0, 0, -templeLen * 0.82),\n            new THREE.Vector3(0, 0, -templeLen)\n        ]);\n        var tipGeo = new THREE.TubeGeometry(tipPath, 16, 1.6, 8, false);\n        pivot.add(new THREE.Mesh(tipGeo, acetateMat));\n\n        // Subtle outward splay\n        pivot.rotation.y = side * 0.06;\n\n        return pivot;\n    }\n\n    g.add(buildTemple(-1));\n    g.add(buildTemple(1));\n\n    // ══════════════════════════════════════════════════════════════════════\n    // HINGE DETAILS (barrel + plate at frame-temple junction)\n    // ══════════════════════════════════════════════════════════════════════\n    function buildHinge(side) {\n        var hg = new THREE.Group();\n\n        // Barrel cylinder\n        var barrelGeo = new THREE.CylinderGeometry(1.4, 1.4, 4, 12);\n        var barrel = new THREE.Mesh(barrelGeo, goldMat);\n        hg.add(barrel);\n\n        // Mounting plate\n        var plateGeo = new THREE.BoxGeometry(3.5, 5, 1.3);\n        var plate = new THREE.Mesh(plateGeo, goldMat);\n        plate.position.set(-side * 1.5, 0, 0);\n        hg.add(plate);\n\n        // Screw head\n        var screwGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.4, 8);\n        var screw = new THREE.Mesh(screwGeo, goldDarkMat);\n        screw.rotation.x = Math.PI / 2;\n        screw.position.set(-side * 2.2, 0, 0.8);\n        hg.add(screw);\n\n        hg.position.set(\n            side * (cx + lensW * 0.5 + 1),\n            lensH * 0.2,\n            -0.5\n        );\n        return hg;\n    }\n\n    g.add(buildHinge(-1));\n    g.add(buildHinge(1));\n\n    // ══════════════════════════════════════════════════════════════════════\n    // RENDER ORDER\n    // ══════════════════════════════════════════════════════════════════════\n    g.traverse(function(child) {\n        if (child.isMesh) child.renderOrder = 3;\n    });\n\n    return g;\n}\n","/**\n * Virtual Try-On Engine\n *\n * Orchestrates the Three.js scene, MediaPipe face tracking, and per-frame\n * glasses placement. All shared state lives in this module; sub-modules\n * (glasses, occluder, scene, helpers) are stateless factories.\n *\n * Public API:\n *   initializeThreejs(objName) — set up scene, camera, models\n *   initializeEngine()         — load MediaPipe and start prediction loop\n */\n\nimport * as THREE from 'three';\nimport { CFG, LM, FACE_OVAL } from './constants';\nimport { clamp, toV, mid, eyeMid, qDelta, toPixels } from './helpers';\nimport { createSunglasses } from './glasses';\nimport { createDynamicFaceMesh } from './occluder';\nimport { createCamera, createVideoBackground, createLights, createRenderer, handleResize } from './scene';\n\n// ── Private State ────────────────────────────────────────────────────────────\nvar faceLandmarker;\nvar glassesObj;\nvar faceObj;\nvar bg;\nvar video;\nvar renderer;\nvar camera;\nvar scene;\nlet predictionInFlight = false;\n\nconst sm = {\n    ready: false,\n    gPos: new THREE.Vector3(),\n    gQuat: new THREE.Quaternion(),\n    gScale: new THREE.Vector3(1, 1, 1),\n    prev: new THREE.Vector3()\n};\n\n// ── Animation Loop ───────────────────────────────────────────────────────────\nfunction animate() {\n    bg.needsUpdate = true;\n    requestAnimationFrame(animate);\n    renderer.render(scene, camera);\n}\n\n// ── Public: Initialize Three.js Scene ────────────────────────────────────────\nexport function initializeThreejs(objName) {\n    video = document.getElementById('tryon-video');\n    var container = document.getElementById('threejsContainer');\n\n    // Camera\n    camera = createCamera(video);\n\n    // Video background\n    var bgResult = createVideoBackground(video, camera);\n    bg = bgResult.bg;\n\n    // Renderer (created early so PMREMGenerator can use it)\n    renderer = createRenderer(video);\n    container.appendChild(renderer.domElement);\n\n    // Scene\n    scene = new THREE.Scene();\n    scene.add(bgResult.sprite);\n\n    // Environment map for realistic reflections on clearcoat / metallic surfaces\n    var pmrem = new THREE.PMREMGenerator(renderer);\n    pmrem.compileCubemapShader();\n    var neutralEnv = pmrem.fromScene(new THREE.Scene()).texture;\n    scene.environment = neutralEnv;\n    pmrem.dispose();\n\n    // Lights\n    createLights().forEach(function(light) { scene.add(light); });\n\n    // Face mesh occluder\n    faceObj = createDynamicFaceMesh();\n    faceObj.visible = false;\n    scene.add(faceObj);\n\n    // Glasses model\n    glassesObj = createSunglasses();\n    glassesObj.visible = false;\n    scene.add(glassesObj);\n\n    window.addEventListener('resize', function() {\n        handleResize(camera, renderer, video);\n    }, false);\n\n    animate();\n}\n\n// ── Public: Initialize MediaPipe Face Tracking ───────────────────────────────\nexport async function initializeEngine() {\n    var vision = await import(\n        /* webpackIgnore: true */\n        'https://unpkg.com/@mediapipe/tasks-vision@0.10.7/vision_bundle.mjs'\n    );\n    var fileset = await vision.FilesetResolver.forVisionTasks(\n        'https://unpkg.com/@mediapipe/tasks-vision@0.10.7/wasm'\n    );\n    faceLandmarker = await vision.FaceLandmarker.createFromOptions(fileset, {\n        baseOptions: {\n            modelAssetPath: 'https://storage.googleapis.com/mediapipe-assets/face_landmarker.task',\n            delegate: 'GPU'\n        },\n        runningMode: 'VIDEO',\n        numFaces: 1,\n        outputFaceBlendshapes: false,\n        outputFacialTransformationMatrixes: false\n    });\n    scheduleNextPrediction();\n}\n\n// Backward-compatible aliases (legacy function names)\nexport { initializeThreejs as IntializeThreejs };\nexport { initializeEngine as IntializeEngine };\n\n// ── Prediction Scheduling ────────────────────────────────────────────────────\nfunction scheduleNextPrediction() {\n    if (!video) {\n        requestAnimationFrame(scheduleNextPrediction);\n        return;\n    }\n    if (typeof video.requestVideoFrameCallback === 'function') {\n        video.requestVideoFrameCallback(function() { renderPrediction(); });\n    } else {\n        requestAnimationFrame(renderPrediction);\n    }\n}\n\n// ── Per-Frame Prediction ─────────────────────────────────────────────────────\nfunction renderPrediction() {\n    if (predictionInFlight) {\n        scheduleNextPrediction();\n        return;\n    }\n    predictionInFlight = true;\n\n    if (!faceLandmarker) {\n        predictionInFlight = false;\n        scheduleNextPrediction();\n        return;\n    }\n\n    var results = faceLandmarker.detectForVideo(video, performance.now());\n\n    if (results.faceLandmarks && results.faceLandmarks.length > 0 && glassesObj) {\n        glassesObj.visible = true;\n        if (faceObj) faceObj.visible = true;\n\n        var pts = toPixels(results.faceLandmarks[0], video);\n\n        // ── Key landmarks ──\n        var lEye = eyeMid(pts, LM.leftEyeInner, LM.leftEyeOuter);\n        var rEye = eyeMid(pts, LM.rightEyeInner, LM.rightEyeOuter);\n        var nose = toV(pts, LM.noseBridge);\n        var nTip = toV(pts, LM.noseTip);\n        var fHead = toV(pts, LM.forehead);\n        var chn = toV(pts, LM.chin);\n        var lTmp = toV(pts, LM.leftTemple);\n        var rTmp = toV(pts, LM.rightTemple);\n        var lChk = toV(pts, LM.leftCheek);\n        var rChk = toV(pts, LM.rightCheek);\n\n        var eMid = mid(lEye, rEye);\n\n        // ── Face measurements ──\n        var eW = lEye.distanceTo(rEye);\n        var tW = lTmp.distanceTo(rTmp);\n        var cW = lChk.distanceTo(rChk);\n        var fW = Math.max(eW, tW, cW);\n        var fH = fHead.distanceTo(chn);\n\n        // ── Orientation (landmark-based) ──\n        var xAxis = rEye.clone().sub(lEye).normalize();\n        var yRaw = fHead.clone().sub(chn).normalize();\n        var zAxis = xAxis.clone().cross(yRaw).normalize();\n\n        if (zAxis.z < 0) zAxis.negate();\n\n        var yAxis = zAxis.clone().cross(xAxis).normalize();\n\n        var rotMat = new THREE.Matrix4().makeBasis(xAxis, yAxis, zAxis);\n        var targetQuat = new THREE.Quaternion().setFromRotationMatrix(rotMat);\n\n        // Z-flip (model faces +Z but scene uses -Z for \"behind\")\n        var flipZ = new THREE.Quaternion().setFromAxisAngle(\n            new THREE.Vector3(0, 0, 1), Math.PI\n        );\n        targetQuat.multiply(flipZ);\n\n        // ── Position ──\n        var btt = nTip.clone().sub(nose);\n        var depAdj = clamp(btt.length() * 0.1, 0, 6);\n\n        var tGPos = eMid.clone()\n            .addScaledVector(xAxis, CFG.glassesCenterX)\n            .addScaledVector(yAxis, CFG.glassesDown)\n            .addScaledVector(zAxis, CFG.glassesDepth + depAdj);\n\n        // ── Scale ──\n        var wS = fW / CFG.refHeadWidth;\n        var hS = fH / CFG.refFaceHeight;\n        var bS = (wS * 0.7) + (hS * 0.3);\n        var gS = bS * CFG.glassesScale;\n\n        var tGScale = new THREE.Vector3(gS, gS, gS);\n\n        // ── Adaptive smoothing ──\n        var mov = tGPos.distanceTo(sm.prev);\n        var aDelta = qDelta(sm.gQuat, targetQuat);\n\n        var aP = clamp(0.15 + mov * 0.015, 0.15, 0.55);\n        var aR = clamp(0.20 + aDelta * 0.6, 0.20, 0.75);\n        var aS = clamp(0.16 + mov * 0.010, 0.16, 0.45);\n\n        if (!sm.ready) {\n            sm.gPos.copy(tGPos);\n            sm.gQuat.copy(targetQuat);\n            sm.gScale.copy(tGScale);\n            sm.ready = true;\n        } else {\n            sm.gPos.lerp(tGPos, aP);\n            sm.gQuat.slerp(targetQuat, aR);\n            sm.gScale.lerp(tGScale, aS);\n        }\n\n        sm.prev.copy(tGPos);\n\n        // ── Apply to glasses ──\n        glassesObj.position.copy(sm.gPos);\n        glassesObj.quaternion.copy(sm.gQuat);\n        glassesObj.scale.copy(sm.gScale);\n        glassesObj.updateWorldMatrix(true, true);\n\n        // ── Update face mesh occluder ──\n        if (faceObj) {\n            var posAttr = faceObj.geometry.getAttribute('position');\n            var cx = 0, cy = 0, cz = 0;\n            var fwdOff = 8;\n            for (var fi = 0; fi < FACE_OVAL.length; fi++) {\n                var fv = toV(pts, FACE_OVAL[fi]);\n                fv.addScaledVector(zAxis, fwdOff);\n                posAttr.setXYZ(fi + 1, fv.x, fv.y, fv.z);\n                cx += fv.x; cy += fv.y; cz += fv.z;\n            }\n            cx /= FACE_OVAL.length;\n            cy /= FACE_OVAL.length;\n            cz /= FACE_OVAL.length;\n\n            var coneD = fW * 0.5;\n            posAttr.setXYZ(0,\n                cx - zAxis.x * coneD,\n                cy - zAxis.y * coneD,\n                cz - zAxis.z * coneD\n            );\n            posAttr.needsUpdate = true;\n        }\n\n    } else {\n        if (glassesObj) glassesObj.visible = false;\n        if (faceObj) faceObj.visible = false;\n        sm.ready = false;\n    }\n\n    predictionInFlight = false;\n    scheduleNextPrediction();\n}\n","import * as THREE from 'three';\n\nconst CANVAS_WIDTH = 640;\n\n/** Create an orthographic camera sized to the video dimensions. */\nexport function createCamera(video) {\n    var vw = video.videoWidth;\n    var vh = video.videoHeight;\n    var cam = new THREE.OrthographicCamera(\n        -vw / 2, vw / 2,\n        vh / 2, -vh / 2,\n        0.1, 5000\n    );\n    cam.position.set(-vw / 2, -vh / 2, 500);\n    return cam;\n}\n\n/** Create the video background sprite and its texture. */\nexport function createVideoBackground(video, camera) {\n    var vw = video.videoWidth;\n    var vh = video.videoHeight;\n\n    var bg = new THREE.Texture(video);\n    bg.minFilter = THREE.LinearFilter;\n\n    var sprite = new THREE.Sprite(new THREE.MeshBasicMaterial({\n        map: bg,\n        depthWrite: false,\n        side: THREE.DoubleSide\n    }));\n    sprite.center.set(0.5, 0.5);\n    sprite.scale.set(-vw, vh, 1);\n    sprite.position.copy(camera.position);\n    sprite.position.z = 0;\n\n    return { bg, sprite };\n}\n\n/** Create the scene lighting (key, fill, rim, accent, ambient). */\nexport function createLights() {\n    // Key light — main illumination from upper front\n    var key = new THREE.DirectionalLight(0xffffff, 1.2);\n    key.position.set(0, 120, 250);\n\n    // Fill light — softer, from left side to reduce harsh shadows\n    var fill = new THREE.DirectionalLight(0xeef0ff, 0.5);\n    fill.position.set(-100, 40, 120);\n\n    // Rim light — back-lighting for edge highlights on frame\n    var rim = new THREE.DirectionalLight(0xffffff, 0.4);\n    rim.position.set(60, 80, -100);\n\n    // Top accent — helps clearcoat reflections on brow line\n    var topAccent = new THREE.DirectionalLight(0xffffff, 0.25);\n    topAccent.position.set(0, 200, 50);\n\n    // Ambient — hemisphere for natural outdoor feel\n    var amb = new THREE.HemisphereLight(0xffffff, 0x444466, 0.5);\n\n    return [key, fill, rim, topAccent, amb];\n}\n\n/** Create the WebGL renderer with production-quality settings. */\nexport function createRenderer(video) {\n    var r = new THREE.WebGLRenderer({\n        antialias: true,\n        alpha: true,\n        preserveDrawingBuffer: true\n    });\n    r.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n    r.setSize(CANVAS_WIDTH, CANVAS_WIDTH * video.videoHeight / video.videoWidth);\n    r.physicallyCorrectLights = true;\n    r.toneMapping = THREE.ACESFilmicToneMapping;\n    r.toneMappingExposure = 1.1;\n    r.outputEncoding = THREE.sRGBEncoding;\n    return r;\n}\n\n/** Handle window resize for the orthographic camera. */\nexport function handleResize(camera, renderer, video) {\n    var vw = video.videoWidth, vh = video.videoHeight;\n    camera.left = -vw / 2;\n    camera.right = vw / 2;\n    camera.top = vh / 2;\n    camera.bottom = -vh / 2;\n    camera.updateProjectionMatrix();\n    renderer.setSize(CANVAS_WIDTH, CANVAS_WIDTH * vh / vw);\n}\n","import * as THREE from 'three';\nimport { FACE_OVAL } from './constants';\n\n/**\n * Create a dynamic face mesh occluder (triangle fan geometry).\n *\n * The mesh has 37 vertices: 36 face oval landmarks + 1 centroid center.\n * Vertices are updated every frame directly from landmark world coordinates\n * in the main prediction loop (see engine/index.js).\n *\n * Render order = 1 (before glasses at 3), colorWrite = false.\n * This writes only to the depth buffer, creating an invisible barrier\n * that hides temple arms behind the face.\n */\nexport function createDynamicFaceMesh() {\n    var nOval = FACE_OVAL.length;\n    var nVerts = nOval + 1;\n\n    var positions = new Float32Array(nVerts * 3);\n    var indices = [];\n\n    // Triangle fan: center (0) → oval[i] (i+1) → oval[next] (next+1)\n    for (var i = 0; i < nOval; i++) {\n        indices.push(0, i + 1, ((i + 1) % nOval) + 1);\n    }\n\n    var geo = new THREE.BufferGeometry();\n    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n    geo.setIndex(indices);\n\n    var mat = new THREE.MeshBasicMaterial({\n        colorWrite: false,\n        side: THREE.DoubleSide\n    });\n\n    var mesh = new THREE.Mesh(geo, mat);\n    mesh.renderOrder = 1;\n    mesh.frustumCulled = false;\n    return mesh;\n}\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\nimport '../style/TryOn.style.css';\nimport { initializeEngine, initializeThreejs } from '../engine';\n\nexport const TryOn = () => {\n    const [isLoading, setIsLoading] = useState(true);\n    const [isRecording, setIsRecording] = useState(false);\n    const recorderRef = useRef(null);\n    const chunksRef = useRef([]);\n\n    useEffect(() => {\n        async function init() {\n            var video = document.getElementById('tryon-video');\n\n            await navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: { facingMode: 'user' }\n            }).then(stream => {\n                video.srcObject = stream;\n            });\n\n            video.oncanplay = () => {\n                video.play();\n                initializeThreejs(\"glasses_premium.gltf\");\n                initializeEngine();\n                setIsLoading(false);\n            };\n        }\n\n        init();\n        return () => {};\n    }, []);\n\n    const handleScreenshot = useCallback(() => {\n        var canvas = document.querySelector('#threejsContainer canvas');\n        if (!canvas) return;\n        var link = document.createElement('a');\n        link.download = 'virtual-tryon-' + Date.now() + '.png';\n        link.href = canvas.toDataURL('image/png');\n        link.click();\n    }, []);\n\n    const handleRecord = useCallback(() => {\n        if (isRecording) {\n            if (recorderRef.current && recorderRef.current.state !== 'inactive') {\n                recorderRef.current.stop();\n            }\n            setIsRecording(false);\n            return;\n        }\n\n        var canvas = document.querySelector('#threejsContainer canvas');\n        if (!canvas) return;\n\n        chunksRef.current = [];\n        var stream = canvas.captureStream(30);\n        var mimeType = MediaRecorder.isTypeSupported('video/webm;codecs=vp9')\n            ? 'video/webm;codecs=vp9'\n            : 'video/webm';\n        var recorder = new MediaRecorder(stream, { mimeType: mimeType });\n\n        recorder.ondataavailable = function(e) {\n            if (e.data.size > 0) chunksRef.current.push(e.data);\n        };\n\n        recorder.onstop = function() {\n            var blob = new Blob(chunksRef.current, { type: 'video/webm' });\n            var url = URL.createObjectURL(blob);\n            var link = document.createElement('a');\n            link.download = 'virtual-tryon-' + Date.now() + '.webm';\n            link.href = url;\n            link.click();\n            URL.revokeObjectURL(url);\n        };\n\n        recorder.start();\n        recorderRef.current = recorder;\n        setIsRecording(true);\n    }, [isRecording]);\n\n    return (\n        <div className=\"tryon-page\">\n            <div className=\"tryon-header\">\n                <h1 className=\"tryon-title\">Virtual Try-On</h1>\n                <p className=\"tryon-subtitle\">AI-Powered Glasses Experience</p>\n            </div>\n\n            <div className=\"tryon-viewport\">\n                {isLoading && (\n                    <div className=\"tryon-loading\">\n                        <div className=\"tryon-spinner\"></div>\n                        <p>Initializing camera...</p>\n                    </div>\n                )}\n                <div id=\"threejsContainer\">\n                    <video id=\"tryon-video\"></video>\n                </div>\n            </div>\n\n            <div className=\"tryon-controls\">\n                <button className=\"tryon-btn\" onClick={handleScreenshot} title=\"Take Screenshot\">\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                        <path d=\"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z\"/>\n                        <circle cx=\"12\" cy=\"13\" r=\"4\"/>\n                    </svg>\n                    Screenshot\n                </button>\n                <button\n                    className={'tryon-btn tryon-btn-record' + (isRecording ? ' recording' : '')}\n                    onClick={handleRecord}\n                    title={isRecording ? 'Stop Recording' : 'Start Recording'}\n                >\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        {isRecording ? (\n                            <rect x=\"6\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" fill=\"currentColor\"/>\n                        ) : (\n                            <circle cx=\"12\" cy=\"12\" r=\"7\" fill=\"currentColor\"/>\n                        )}\n                    </svg>\n                    {isRecording ? 'Stop' : 'Record'}\n                </button>\n            </div>\n\n            <p className=\"tryon-footer\">Powered by MediaPipe + Three.js</p>\n        </div>\n    );\n};\n","import React from 'react';\nimport { TryOn } from './TryOn';\n\nexport default function App() {\n    return (\n        <div className=\"App\">\n            <TryOn />\n        </div>\n    );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './style/index.style.css';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.unregister();\n"],"sourceRoot":""}